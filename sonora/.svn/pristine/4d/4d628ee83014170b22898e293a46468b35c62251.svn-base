/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package br.edu.ifsc.sonora.dao;

import com.mongodb.DB;
import com.mongodb.MongoClient;
import com.mongodb.MongoClientURI;
import java.util.HashMap;
import javax.annotation.PostConstruct;
import javax.enterprise.context.ApplicationScoped;
import org.jongo.Jongo;
import org.jongo.MongoCollection;

/**
 *
 * @author renato
 */
@ApplicationScoped
public class MongoConnectionFactory {

    private Jongo jongo;
    private final HashMap<String, MongoCollection> collections = new HashMap<String, MongoCollection>();

    @PostConstruct
    public void init() {
        if (jongo == null) {
//            DB db = new MongoClient().getDB("iflab");
            DB db = new MongoClient(new MongoClientURI("mongodb://iflab:iflab@ds017584.mlab.com:17584/iflab")).getDB("iflab");
//            DB db = new MongoClient(new MongoClientURI("mongodb://appraga:appraga@ds153815.mlab.com:53815/appraga")).getDB("appraga");
            jongo = new Jongo(db);
            System.out.println("Conectou Mongo");
        }
    }

    public MongoCollection getCollectionInstance(String table) throws Exception {
        MongoCollection col = collections.get(table);
        if (col == null) {
            col = jongo.getCollection(table);
            collections.put(table, col);
        }
        return col;
    }
}
